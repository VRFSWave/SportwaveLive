<script>
    async function fetchLiveGames() {
        try {
            const response = await fetch('https://streamed.su/api/matches/all-today');
            const games = await response.json();

            const gamesContainer = document.getElementById('games-container');
            const optionsContainer = document.getElementById('options-container');
            const streamOptionsDiv = document.getElementById('stream-options');
            const liveStreamDiv = document.getElementById('live-stream');
            const streamFrame = document.getElementById('stream-frame');

            games.forEach(game => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game';

                gameDiv.innerHTML = `
                    <h3>${game.title}</h3>
                    <button class="watch-button" onclick="fetchStreams('${game.id}')">Watch</button>
                `;

                gamesContainer.appendChild(gameDiv);
            });

            window.fetchStreams = async (gameId) => {
                try {
                    const response = await fetch(`https://streamed.su/api/stream/alpha/${gameId}`);
                    const streams = await response.json();

                    optionsContainer.innerHTML = '';

                    streams.forEach((stream, index) => {
                        const streamOption = document.createElement('div');
                        streamOption.className = 'stream-option';

                        const modifiedEmbedUrl = stream.embedurl.replace('https://', 'https://embedme.top/');

                        streamOption.innerHTML = `
                            <button class="watch-button" onclick="showStream('${modifiedEmbedUrl}')">Stream ${index + 1}</button>
                        `;

                        optionsContainer.appendChild(streamOption);
                    });

                    streamOptionsDiv.style.display = 'block';
                    liveStreamDiv.style.display = 'none';
                } catch (error) {
                    console.error('Error fetching streams:', error);
                }
            };

            window.showStream = (embedUrl) => {
                streamFrame.src = embedUrl;
                streamOptionsDiv.style.display = 'none';
                liveStreamDiv.style.display = 'block';
            };

        } catch (error) {
            console.error('Error fetching live games:', error);
        }
    }

    fetchLiveGames();
</script>
